<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kt.sqms.batch.mapper.ParallelQueryMapper">

    <!-- 현재 세션의 PostgreSQL 백엔드 PID 조회 -->
    <select id="selectCurrentPid" resultType="java.lang.Integer">
        SELECT pg_backend_pid()
    </select>

    <!-- 특정 리더 PID의 병렬 워커 세션 수 조회 -->
    <select id="selectParallelWorkerCount" parameterType="java.lang.Integer" resultType="int">
        SELECT COUNT(*)
          FROM pg_stat_activity
         WHERE leader_pid = #{leaderPid}
    </select>

    <!-- 특정 PID의 쿼리 취소 (우아한 중단) -->
    <select id="cancelQuery" parameterType="java.lang.Integer" resultType="boolean">
        SELECT pg_cancel_backend(#{pid})
    </select>

    <!-- 특정 PID의 세션 강제 종료 -->
    <select id="terminateSession" parameterType="java.lang.Integer" resultType="boolean">
        SELECT pg_terminate_backend(#{pid})
    </select>

</mapper>
